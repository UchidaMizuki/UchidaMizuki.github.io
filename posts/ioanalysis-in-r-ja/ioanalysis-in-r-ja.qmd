---
title: "🗾Rで産業連関分析"
lang: ja
date: "2022-05-31"
categories: [ioanalysis, R, Japanese]
---

産業連関分析は，経済波及効果の算出に広く用いられている分析手法です．
日本では，国や都道府県によって，約5年に1度，産業連関表と呼ばれる統計データが
作成・公開されており，産業連関分析における基礎データとなっています．

これまで，産業連関分析では，Excel・VBAが用いられることが多かったようです．

一方で，近年は，Python・R・Juliaなどのプログラミング言語の普及が進んでいます．
これらのプログラミング言語は以下のような特長を持っています．

- 無料で利用することができる
- 作業の再現性が高まりミスが修正しやすい・他者がミスに気づきやすい
- 高度な分析手法が簡単に利用できる

そのため今後は，産業連関分析においても，これらのプログラミング言語の利用が
進むのではないかと思われます．

ここでは，Rを用いて産業連関分析を行います．
Rでは近年，tidyverseなどモダンなデータ分析を行うためのパッケージが
多く提供されており，プログラミング初心者でも習得しやすい言語であると思います．

産業連関表として，e-Statのデータベースで公開されている日本（国）の
2013年・13部門産業連関表を用います．
ここで使用するデータは，
[こちら](https://github.com/UchidaMizuki/blog-ioanalysis-in-r)
からダウンロードできます．



## 分析の流れ

一般的な産業連関分析の流れは以下の通りです．

1. 産業連関表の整形
1. 投入係数行列の算出
1. レオンチェフ逆行列の算出
1. 経済波及効果の算出

以上の流れに沿って，Rによる産業連関分析の計算例を示します．



## Rによる産業連関分析
### 産業連関表の整形

ここでは，
[こちら](https://github.com/UchidaMizuki/blog-ioanalysis-in-r)
からダウンロードできる日本の2011年の3部門表（`iotable_3sector_2011_wider.csv`）を
使用します．

こちらの表は，以下のように，日本の2011年の13部門表より作成したものです．

* 13部門の産業分類を第1次・第2次・第3次産業に集計
* 付加価値部門は1部門に集計
* 最終需要部門は域内最終需要（`finaldemand`）・輸出（`export`）・輸入（`import`）の3部門に集計

産業連関表のデータ形式は，e-Statのデータベースで提供されている表などを除いて，
行に投入部門（`input`）・列に産出部門（`output`）を持つ「横長データ」であることが多いと思われます．

ここでも，以下の通り，まずは横長の産業連関表データを読み込みます．

```{r, message=FALSE}
library(tidyverse)

iotable_wider <- read_csv("iotable_3sector_2011_wider.csv",
                          col_types = cols(.default = "c")) |> 
  mutate(across(-1, parse_number))

knitr::kable(iotable_wider)
```

データ分析においては，「横長データ」よりも，以下のような「縦長データ」のほうが，
分析しやすい場合が多くあります．
ここでも，横長の産業連関表を「縦長データ」に変換します．

```{r, message=FALSE}
iotable <- iotable_wider |>
  separate(input, c("input_type", "input_name"),
           sep = "/") |>
  pivot_longer(!c(input_type, input_name),
               names_to = c("output_type", "output_name"),
               names_sep = "/",
               values_to = "value_M") |>
  drop_na(value_M)

knitr::kable(iotable)
```

上で構築した表データは，各行のフィルタリングなどが容易にできる一方で，
産業連関分析に用いられる行列計算などに適していません．

そこで，表データの見た目のまま行列計算を行えるdibbleパッケージを用います．
以下では，産業連関表をdibbleに変換しています．

```{r message=FALSE}
library(dibble)

iotable <- iotable |>
  dibble_by(input = c(input_type, input_name),
            output = c(output_type, output_name),
            .names_sep = "_")

iotable
```

### 投入係数行列の算出

投入係数は以下のように表される．

$$
a_{ij}=\frac{x_{ij}}{X_j}
$$

```{r}
total_input <- iotable |>
  filter(output$type == "industry") |>
  apply("output", sum)

interindustry <- iotable |>
  filter(input$type == "industry",
         output$type == "industry")

inputcoeff <- broadcast(interindustry / total_input,
                        c("input", "output"))

inputcoeff
```



### レオンチェフ逆行列の算出

TODO

$$
[I-(I-M)A]^{-1}
$$

```{r}
localoutput <- iotable |>
  filter(input$type == "industry",
         !output$type %in% c("export", "import")) |>
  apply("input", sum)

import <- iotable |>
  filter(input$type == "industry",
         output$type == "import") |>
  apply("input", sum)
import <- -import

importcoeff <- import / localoutput

I <- eye(inputcoeff)
M <- importcoeff
A <- inputcoeff

leontiefinv <- broadcast(I - (1 - M) * A,
                         c("input", "output")) |>
  solve()

leontiefinv
```

### 経済波及効果の算出

TODO

## まとめ

TODO